// -------------------------------------------------------------
// 
// File Name: hdl_prj\hdlsrc\HSG\HSG_IP_src_FIFOHandlerFSM.v
// Created: 2018-10-21 17:42:58
// 
// Generated by MATLAB 9.3 and HDL Coder 3.11
// 
// -------------------------------------------------------------


// -------------------------------------------------------------
// 
// Module: HSG_IP_src_FIFOHandlerFSM
// Source Path: HSG/HSG/Edge Detector/LineBuffer/FIFOHandlerFSM
// Hierarchy Level: 3
// 
// -------------------------------------------------------------

`timescale 1 ns / 1 ns

module HSG_IP_src_FIFOHandlerFSM
          (clk,
           reset,
           enb,
           allLineStart,
           hStartIn,
           vEndIn,
           validIn,
           lineSpaceAverageIn,
           allNextLineStart,
           vEndFlag,
           allFIFOEmpty,
           vStartIn,
           hEndIn,
           halfLoaded,
           pushFIFO,
           popFIFO,
           upperPop,
           InitializeFlag,
           enableDataCacheOut,
           unloadhStartOut,
           unloadhEndOut,
           unloadvEndOut,
           unloadValidOut,
           unloadingDelayedOut,
           lineMaskOut,
           runOrUnload,
           validOut,
           delayedVStartOut,
           load,
           loadingFlag,
           Unloading,
           lineSpaceLoad,
           lineSpaceEn,
           loadCount);


  input   clk;
  input   reset;
  input   enb;
  input   allLineStart;
  input   hStartIn;
  input   vEndIn;
  input   validIn;
  input   [11:0] lineSpaceAverageIn;  // ufix12
  input   allNextLineStart;
  input   vEndFlag;
  input   allFIFOEmpty;
  input   vStartIn;
  input   hEndIn;
  input   halfLoaded;
  output  [1:0] pushFIFO;  // ufix2
  output  [1:0] popFIFO;  // ufix2
  output  upperPop;  // ufix1
  output  InitializeFlag;
  output  enableDataCacheOut;
  output  unloadhStartOut;
  output  unloadhEndOut;
  output  unloadvEndOut;
  output  unloadValidOut;
  output  unloadingDelayedOut;
  output  [1:0] lineMaskOut;  // ufix2
  output  runOrUnload;
  output  validOut;
  output  delayedVStartOut;
  output  load;
  output  loadingFlag;
  output  Unloading;
  output  lineSpaceLoad;
  output  lineSpaceEn;
  output  [7:0] loadCount;  // ufix8

  reg [7:0] FIFOHandler_LoadingPaddingRunCount;  // uint8
  reg [7:0] FIFOHandler_RunningPaddingRunCount;  // uint8
  reg [7:0] FIFOHandler_UnloadingPaddingRunCount;  // uint8
  reg [7:0] FIFOHandler_InterFrameCount;  // uint8
  reg [7:0] FIFOHandler_InitializeCount;  // uint8
  reg  FIFOHandler_Loading;
  reg  FIFOHandler_Loading_not_empty;
  reg  FIFOHandler_Unloading;
  reg  FIFOHandler_Running;
  reg  FIFOHandler_Initialize;
  reg  FIFOHandler_DelayedVStart;
  reg  FIFOHandler_InBetween;
  reg [1:0] FIFOHandler_LineMask;  // ufix2
  reg signed [15:0] FIFOHandler_removeThis;  // int16
  reg  FIFOHandler_InterFrameReset;
  reg  [0:2] FIFOHandler_unloadToggle;  // boolean [3]
  reg [7:0] FIFOHandler_LoadingPaddingRunCount_next;  // uint8
  reg [7:0] FIFOHandler_RunningPaddingRunCount_next;  // uint8
  reg [7:0] FIFOHandler_UnloadingPaddingRunCount_next;  // uint8
  reg [7:0] FIFOHandler_InterFrameCount_next;  // uint8
  reg [7:0] FIFOHandler_InitializeCount_next;  // uint8
  reg  FIFOHandler_Loading_next;
  reg  FIFOHandler_Loading_not_empty_next;
  reg  FIFOHandler_Unloading_next;
  reg  FIFOHandler_Running_next;
  reg  FIFOHandler_Initialize_next;
  reg  FIFOHandler_DelayedVStart_next;
  reg  FIFOHandler_InBetween_next;
  reg [1:0] FIFOHandler_LineMask_next;  // ufix2
  reg signed [15:0] FIFOHandler_removeThis_next;  // int16
  reg  FIFOHandler_InterFrameReset_next;
  reg  [0:2] FIFOHandler_unloadToggle_next;  // boolean [3]
  reg [1:0] pushFIFO_1;  // ufix2
  reg [1:0] popFIFO_1;  // ufix2
  reg  upperPop_1;  // ufix1
  reg  InitializeFlag_1;
  reg  enableDataCacheOut_1;
  reg  unloadhStartOut_1;
  reg  unloadhEndOut_1;
  reg  unloadvEndOut_1;
  reg  unloadValidOut_1;
  reg  unloadingDelayedOut_1;
  reg [1:0] lineMaskOut_1;  // ufix2
  reg  runOrUnload_1;
  reg  validOut_1;
  reg  delayedVStartOut_1;
  reg  load_1;
  reg  loadingFlag_1;
  reg  Unloading_1;
  reg  lineSpaceLoad_1;
  reg  lineSpaceEn_1;
  reg [7:0] loadCount_1;  // ufix8
  reg [1:0] FIFOHandler_out0_0;  // ufix2
  reg [1:0] FIFOHandler_out1_0;  // ufix2
  reg  FIFOHandler_out5_0;
  reg  FIFOHandler_out6_0;
  reg [7:0] FIFOHandler_LoadingPaddingRunCount_temp;  // uint8
  reg [7:0] FIFOHandler_RunningPaddingRunCount_temp;  // uint8
  reg [7:0] FIFOHandler_InterFrameCount_temp;  // uint8
  reg [7:0] FIFOHandler_InitializeCount_temp;  // uint8
  reg  FIFOHandler_Loading_temp;
  reg  FIFOHandler_Unloading_temp;
  reg  FIFOHandler_Running_temp;
  reg  FIFOHandler_Initialize_temp;
  reg  FIFOHandler_DelayedVStart_temp;
  reg  FIFOHandler_InBetween_temp;
  reg [1:0] FIFOHandler_LineMask_temp;  // ufix2
  reg signed [15:0] FIFOHandler_removeThis_temp;  // int16
  reg  FIFOHandler_InterFrameReset_temp;
  reg  [0:2] FIFOHandler_unloadToggle_temp;  // boolean [3]
  reg  [0:1] FIFOHandler_unloadToggle_temp_0;  // boolean [2]


  // FIFO Handler - control FIFO access
  always @(posedge clk or posedge reset)
    begin : FIFOHandler_process
      if (reset == 1'b1) begin
        FIFOHandler_LoadingPaddingRunCount <= 8'd0;
        FIFOHandler_RunningPaddingRunCount <= 8'd0;
        FIFOHandler_UnloadingPaddingRunCount <= 8'd0;
        FIFOHandler_InterFrameCount <= 8'd0;
        FIFOHandler_InitializeCount <= 8'd0;
        FIFOHandler_Loading <= 1'b0;
        FIFOHandler_Unloading <= 1'b0;
        FIFOHandler_Running <= 1'b0;
        FIFOHandler_Initialize <= 1'b1;
        FIFOHandler_InterFrameReset <= 1'b0;
        FIFOHandler_DelayedVStart <= 1'b0;
        FIFOHandler_InBetween <= 1'b0;
        FIFOHandler_LineMask <= 2'b00;
        FIFOHandler_removeThis <= 16'sd0;
        FIFOHandler_unloadToggle[0] <= 1'b0;
        FIFOHandler_unloadToggle[1] <= 1'b0;
        FIFOHandler_unloadToggle[2] <= 1'b0;
        FIFOHandler_Loading_not_empty <= 1'b0;
      end
      else begin
        if (enb) begin
          FIFOHandler_LoadingPaddingRunCount <= FIFOHandler_LoadingPaddingRunCount_next;
          FIFOHandler_RunningPaddingRunCount <= FIFOHandler_RunningPaddingRunCount_next;
          FIFOHandler_UnloadingPaddingRunCount <= FIFOHandler_UnloadingPaddingRunCount_next;
          FIFOHandler_InterFrameCount <= FIFOHandler_InterFrameCount_next;
          FIFOHandler_InitializeCount <= FIFOHandler_InitializeCount_next;
          FIFOHandler_Loading <= FIFOHandler_Loading_next;
          FIFOHandler_Loading_not_empty <= FIFOHandler_Loading_not_empty_next;
          FIFOHandler_Unloading <= FIFOHandler_Unloading_next;
          FIFOHandler_Running <= FIFOHandler_Running_next;
          FIFOHandler_Initialize <= FIFOHandler_Initialize_next;
          FIFOHandler_DelayedVStart <= FIFOHandler_DelayedVStart_next;
          FIFOHandler_InBetween <= FIFOHandler_InBetween_next;
          FIFOHandler_LineMask <= FIFOHandler_LineMask_next;
          FIFOHandler_removeThis <= FIFOHandler_removeThis_next;
          FIFOHandler_InterFrameReset <= FIFOHandler_InterFrameReset_next;
          FIFOHandler_unloadToggle[0] <= FIFOHandler_unloadToggle_next[0];
          FIFOHandler_unloadToggle[1] <= FIFOHandler_unloadToggle_next[1];
          FIFOHandler_unloadToggle[2] <= FIFOHandler_unloadToggle_next[2];
        end
      end
    end

  always @* begin
    FIFOHandler_LoadingPaddingRunCount_temp = FIFOHandler_LoadingPaddingRunCount;
    FIFOHandler_RunningPaddingRunCount_temp = FIFOHandler_RunningPaddingRunCount;
    FIFOHandler_InterFrameCount_temp = FIFOHandler_InterFrameCount;
    FIFOHandler_InitializeCount_temp = FIFOHandler_InitializeCount;
    FIFOHandler_Loading_temp = FIFOHandler_Loading;
    FIFOHandler_Unloading_temp = FIFOHandler_Unloading;
    FIFOHandler_Running_temp = FIFOHandler_Running;
    FIFOHandler_Initialize_temp = FIFOHandler_Initialize;
    FIFOHandler_DelayedVStart_temp = FIFOHandler_DelayedVStart;
    FIFOHandler_InBetween_temp = FIFOHandler_InBetween;
    FIFOHandler_LineMask_temp = FIFOHandler_LineMask;
    FIFOHandler_removeThis_temp = FIFOHandler_removeThis;
    FIFOHandler_InterFrameReset_temp = FIFOHandler_InterFrameReset;
    FIFOHandler_unloadToggle_temp[0] = FIFOHandler_unloadToggle[0];
    FIFOHandler_unloadToggle_temp[1] = FIFOHandler_unloadToggle[1];
    FIFOHandler_unloadToggle_temp[2] = FIFOHandler_unloadToggle[2];
    FIFOHandler_UnloadingPaddingRunCount_next = FIFOHandler_UnloadingPaddingRunCount;
    FIFOHandler_Loading_not_empty_next = FIFOHandler_Loading_not_empty;
    if ( ! FIFOHandler_Loading_not_empty) begin
      FIFOHandler_Loading_not_empty_next = 1'b1;
    end
    FIFOHandler_out1_0 = 2'b00;
    FIFOHandler_out0_0 = 2'b00;
    enableDataCacheOut_1 = 1'b0;
    FIFOHandler_out5_0 = 1'b0;
    FIFOHandler_out6_0 = 1'b0;
    unloadvEndOut_1 = 1'b0;
    unloadValidOut_1 = 1'b0;
    unloadingDelayedOut_1 = 1'b0;
    lineMaskOut_1 = 2'b00;
    load_1 = 1'b0;
    upperPop_1 = 1'b0;
    if (vStartIn != 1'b0) begin
      FIFOHandler_Loading_temp = 1'b1;
      FIFOHandler_Unloading_temp = 1'b0;
      FIFOHandler_Initialize_temp = 1'b0;
      FIFOHandler_InterFrameReset_temp = 1'b0;
      FIFOHandler_removeThis_temp = 16'sd0;
      FIFOHandler_LoadingPaddingRunCount_temp = 8'd1;
      FIFOHandler_InterFrameCount_temp = 8'd0;
      FIFOHandler_InitializeCount_temp = 8'd0;
    end
    else if (hEndIn != 1'b0) begin
      FIFOHandler_LoadingPaddingRunCount_temp = FIFOHandler_LoadingPaddingRunCount - 8'd1;
    end
    if (validIn && FIFOHandler_Loading_temp) begin
      FIFOHandler_DelayedVStart_temp = 1'b0;
      FIFOHandler_out0_0 = 2'b01;
      FIFOHandler_out1_0 = 2'b11;
      if ((FIFOHandler_Loading_temp && hStartIn) && (FIFOHandler_LoadingPaddingRunCount_temp == 8'd0)) begin
        FIFOHandler_Loading_temp = 1'b0;
        FIFOHandler_RunningPaddingRunCount_temp = 8'd0;
        FIFOHandler_Running_temp = 1'b1;
        FIFOHandler_Unloading_temp = 1'b0;
        FIFOHandler_unloadToggle_temp[0] = 1'b0;
        FIFOHandler_unloadToggle_temp[1] = 1'b0;
        FIFOHandler_unloadToggle_temp[2] = 1'b0;
        FIFOHandler_Initialize_temp = 1'b0;
        FIFOHandler_DelayedVStart_temp = 1'b1;
        FIFOHandler_out1_0 = 2'b01;
      end
    end
    if (FIFOHandler_Running_temp) begin
      if (FIFOHandler_removeThis_temp == 16'sd1) begin
        FIFOHandler_DelayedVStart_temp = 1'b0;
      end
      FIFOHandler_removeThis_temp = 16'sd1;
      if (hStartIn && FIFOHandler_DelayedVStart_temp) begin
        FIFOHandler_RunningPaddingRunCount_temp = 8'd0;
      end
      else if ((hStartIn != 1'b0) && (FIFOHandler_RunningPaddingRunCount_temp != 8'd1)) begin
        FIFOHandler_RunningPaddingRunCount_temp = 8'd1;
      end
      enableDataCacheOut_1 = 1'b1;
      FIFOHandler_out1_0 = FIFOHandler_out1_0 | 2'b01;
      FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b10;
      if ((FIFOHandler_RunningPaddingRunCount_temp == 8'd1) &&  ! FIFOHandler_DelayedVStart_temp) begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 | 2'b10;
      end
      if (validIn != 1'b0) begin
        FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b01;
      end
    end
    runOrUnload_1 = FIFOHandler_Running_temp || FIFOHandler_Unloading_temp;
    if (FIFOHandler_Unloading_temp) begin
      if ((( ! FIFOHandler_InBetween) && allNextLineStart) && FIFOHandler_unloadToggle_temp[2]) begin
        FIFOHandler_out6_0 = 1'b1;
        unloadvEndOut_1 = FIFOHandler_UnloadingPaddingRunCount == 8'd0;
        FIFOHandler_unloadToggle_temp[0] = 1'b0;
      end
      FIFOHandler_unloadToggle_temp_0[1] = FIFOHandler_unloadToggle_temp[1];
      FIFOHandler_unloadToggle_temp[1] = FIFOHandler_unloadToggle_temp[0];
      FIFOHandler_unloadToggle_temp[2] = FIFOHandler_unloadToggle_temp_0[1];
      if (FIFOHandler_InBetween) begin
        if (lineSpaceAverageIn == 12'b000000000001) begin
          unloadingDelayedOut_1 = 1'b1;
          FIFOHandler_InBetween_temp = 1'b0;
          if (FIFOHandler_UnloadingPaddingRunCount == 8'd0) begin
            FIFOHandler_Unloading_temp = 1'b0;
            FIFOHandler_InterFrameReset_temp = 1'b1;
            lineSpaceEn_1 = 1'b1;
            FIFOHandler_unloadToggle_temp[0] = 1'b0;
            FIFOHandler_unloadToggle_temp[1] = 1'b0;
            FIFOHandler_unloadToggle_temp[2] = 1'b0;
          end
          else begin
            lineSpaceEn_1 = 1'b1;
            FIFOHandler_UnloadingPaddingRunCount_next = FIFOHandler_UnloadingPaddingRunCount - 8'd1;
            FIFOHandler_out5_0 = 1'b1;
            FIFOHandler_LineMask_temp = FIFOHandler_LineMask <<< 8'd1;
            FIFOHandler_unloadToggle_temp[0] = 1'b1;
          end
        end
        else begin
          lineSpaceEn_1 = 1'b1;
        end
      end
      else begin
        lineSpaceEn_1 = 1'b0;
      end
      lineMaskOut_1 = FIFOHandler_LineMask_temp;
      enableDataCacheOut_1 = 1'b1;
      if ( ! FIFOHandler_InBetween_temp) begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 | 2'b10;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b10;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b01;
        FIFOHandler_out1_0 = FIFOHandler_out1_0 | 2'b01;
        upperPop_1 = 1'b1;
      end
      else begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b10;
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b10;
      end
      if (FIFOHandler_out6_0 && ( ! FIFOHandler_out5_0)) begin
        FIFOHandler_InBetween_temp = 1'b1;
        lineSpaceLoad_1 = 1'b0;
      end
      else begin
        lineSpaceLoad_1 = lineSpaceAverageIn == 12'b000000000010;
      end
      unloadValidOut_1 =  ! FIFOHandler_InBetween_temp;
    end
    else begin
      lineSpaceLoad_1 = 1'b0;
      lineSpaceEn_1 = 1'b0;
    end
    if ((validIn != 1'b0) && (vEndIn != 1'b0)) begin
      FIFOHandler_InBetween_temp = 1'b1;
      lineSpaceLoad_1 = 1'b1;
      FIFOHandler_UnloadingPaddingRunCount_next = 8'd1;
      FIFOHandler_LineMask_temp = FIFOHandler_LineMask_temp | 2'b01;
      FIFOHandler_LineMask_temp = FIFOHandler_LineMask_temp & 2'b01;
      FIFOHandler_out5_0 = 1'b0;
      FIFOHandler_out1_0 = FIFOHandler_out1_0 | 2'b10;
      FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b10;
      upperPop_1 = 1'b1;
      FIFOHandler_Loading_temp = 1'b0;
      FIFOHandler_Running_temp = 1'b0;
      FIFOHandler_Unloading_temp = 1'b1;
      FIFOHandler_InterFrameReset_temp = 1'b0;
      enableDataCacheOut_1 = 1'b1;
    end
    if (FIFOHandler_InterFrameReset_temp) begin
      if (FIFOHandler_InterFrameCount_temp < 8'd6) begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b01;
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b10;
        enableDataCacheOut_1 = 1'b1;
        FIFOHandler_InterFrameCount_temp = FIFOHandler_InterFrameCount_temp + 8'd1;
        load_1 = 1'b1;
      end
      else begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b10;
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b10;
        enableDataCacheOut_1 = 1'b1;
        load_1 = 1'b1;
      end
    end
    if (FIFOHandler_Initialize_temp) begin
      if (FIFOHandler_InitializeCount_temp < 8'd6) begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b10;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 | 2'b01;
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b10;
        FIFOHandler_InitializeCount_temp = FIFOHandler_InitializeCount_temp + 8'd1;
        enableDataCacheOut_1 = 1'b1;
        load_1 = 1'b0;
      end
      else begin
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b01;
        FIFOHandler_out0_0 = FIFOHandler_out0_0 & 2'b10;
        FIFOHandler_out1_0 = FIFOHandler_out1_0 & 2'b10;
        enableDataCacheOut_1 = 1'b1;
        load_1 = 1'b1;
      end
    end
    InitializeFlag_1 = FIFOHandler_Initialize_temp || FIFOHandler_InterFrameReset_temp;
    pushFIFO_1 = FIFOHandler_out0_0;
    popFIFO_1 = FIFOHandler_out1_0;
    unloadhStartOut_1 = FIFOHandler_out5_0;
    unloadhEndOut_1 = FIFOHandler_out6_0;
    validOut_1 = validIn;
    delayedVStartOut_1 = FIFOHandler_DelayedVStart_temp;
    loadingFlag_1 = FIFOHandler_Loading_temp;
    Unloading_1 = FIFOHandler_Unloading_temp;
    loadCount_1 = FIFOHandler_LoadingPaddingRunCount_temp;
    FIFOHandler_LoadingPaddingRunCount_next = FIFOHandler_LoadingPaddingRunCount_temp;
    FIFOHandler_RunningPaddingRunCount_next = FIFOHandler_RunningPaddingRunCount_temp;
    FIFOHandler_InterFrameCount_next = FIFOHandler_InterFrameCount_temp;
    FIFOHandler_InitializeCount_next = FIFOHandler_InitializeCount_temp;
    FIFOHandler_Loading_next = FIFOHandler_Loading_temp;
    FIFOHandler_Unloading_next = FIFOHandler_Unloading_temp;
    FIFOHandler_Running_next = FIFOHandler_Running_temp;
    FIFOHandler_Initialize_next = FIFOHandler_Initialize_temp;
    FIFOHandler_DelayedVStart_next = FIFOHandler_DelayedVStart_temp;
    FIFOHandler_InBetween_next = FIFOHandler_InBetween_temp;
    FIFOHandler_LineMask_next = FIFOHandler_LineMask_temp;
    FIFOHandler_removeThis_next = FIFOHandler_removeThis_temp;
    FIFOHandler_InterFrameReset_next = FIFOHandler_InterFrameReset_temp;
    FIFOHandler_unloadToggle_next[0] = FIFOHandler_unloadToggle_temp[0];
    FIFOHandler_unloadToggle_next[1] = FIFOHandler_unloadToggle_temp[1];
    FIFOHandler_unloadToggle_next[2] = FIFOHandler_unloadToggle_temp[2];
  end



  assign pushFIFO = pushFIFO_1;

  assign popFIFO = popFIFO_1;

  assign upperPop = upperPop_1;

  assign InitializeFlag = InitializeFlag_1;

  assign enableDataCacheOut = enableDataCacheOut_1;

  assign unloadhStartOut = unloadhStartOut_1;

  assign unloadhEndOut = unloadhEndOut_1;

  assign unloadvEndOut = unloadvEndOut_1;

  assign unloadValidOut = unloadValidOut_1;

  assign unloadingDelayedOut = unloadingDelayedOut_1;

  assign lineMaskOut = lineMaskOut_1;

  assign runOrUnload = runOrUnload_1;

  assign validOut = validOut_1;

  assign delayedVStartOut = delayedVStartOut_1;

  assign load = load_1;

  assign loadingFlag = loadingFlag_1;

  assign Unloading = Unloading_1;

  assign lineSpaceLoad = lineSpaceLoad_1;

  assign lineSpaceEn = lineSpaceEn_1;

  assign loadCount = loadCount_1;

endmodule  // HSG_IP_src_FIFOHandlerFSM

